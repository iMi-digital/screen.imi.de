<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">

    <title>screen.imi.de Screensharing</title>

    <meta name="description" content="Screen Sharing"/>
    <meta name="keywords" content="WebRTC,RTCMultiConnection,Screen Sharing"/>

    <script src="//code.jquery.com/jquery-1.12.0.min.js"></script>
    <script src="//code.jquery.com/jquery-migrate-1.2.1.min.js"></script>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css"
          integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css"
          integrity="sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r" crossorigin="anonymous">

    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"
            integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS"
            crossorigin="anonymous"></script>

    <link rel="stylesheet" href="/demos/style.css">

</head>

<body>

<div class="container">
    <div class="page-header">
        <h1>iMi Bildschirmfreigabe</h1>
    </div>


    <section class="experiment">
        <div class="make-center">
            Code: <input type="text" id="room-id" value="">
            <button id="open-room" class="btn btn-warning">Bildschirm freigeben</button>
            <button id="join-room" class="btn btn-success">Freigebenen Bildschirm öffnen</button>
        </div>

        <div class="share-alert alert alert-success alert-dismissible" role="alert">
            <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span
                    aria-hidden="true">&times;</span></button>
            <p>

            <strong>Bitte teilen Sie den folgenden Link oder den angezeigen Code Ihrem Partner mit:</strong>
            <a id="shareLink"></a>
        </div>


        <div id="videos-container"></div>


        <div class="alert alert-info alert-dismissible" role="alert">
            <span class="info-icon glyphicon glyphicon-info-sign" aria-hidden="true"></span>

            <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span
                    aria-hidden="true">&times;</span></button>
            <p>
                Das <strong>Anschauen</strong> eines freigebenen Bildschirms funktioniert <strong>ohne Installation.</strong></p>
            </p>

            <p>
                Das <strong>Freigeben</strong> Ihres Bildschirms oder einzelner Fenster funktioniert nur in Chrome oder Firefox
                    <strong>nach Installation eines Plugins</strong>.</strong>
            </p>
            <p>
                <a class="btn btn-default"
                   href="https://chrome.google.com/webstore/detail/screen-capturing/ajhifddimkapgcifgcodmmfdlknahffk"
                   target="_blank">Installation für Google Chrome</a></li>
                <a class="btn btn-default"
                   href="https://www.webrtc-experiment.com/store/firefox-extension/enable-screen-capturing.xpi"
                   target="_blank">Installation für Firefox</a>
            </p>

        </div>


    </section>
</div>

<!-- <script src="/RTCMultiConnection.min.js"></script> -->
<script src="/dist/rmc3.min.js"></script>

<!-- socket.io for signaling -->
<script src="/socket.io/socket.io.js"></script>

<script>
    // ......................................................
    // .......................UI Code........................
    // ......................................................


    /*document.getElementById('open-or-join-room').onclick = function () {
        this.disabled = true;
        connection.openOrJoin(document.getElementById('room-id').value);
    };*/

    // ......................................................
    // ..................RTCMultiConnection Code.............
    // ......................................................

    var connection = new RTCMultiConnection();

    function getRandomInt(min, max) {
        return Math.floor(Math.random() * (max - min + 1)) + min;
    }


    connection.session = {
        screen: true,
        oneway: true
    };

    connection.sdpConstraints.mandatory = {
        OfferToReceiveAudio: false,
        OfferToReceiveVideo: false
    };

    var videosContainer = document.getElementById('videos-container');
    connection.onstream = function (event) {
        videosContainer.appendChild(event.mediaElement);
    };


    joinRoom = function() {
        if ($('#room-id').val() == '') {
            window.alert('Bitte geben Sie zuerst den Code Ihres Partners ein.');
            return;
        }

        this.disabled = true;
        connection.join(document.getElementById('room-id').value);
    }

    if (window.location.hash) {
        $('#room-id').val(window.location.hash.substr(1));
        joinRoom();
    }

    document.getElementById('open-room').onclick = function () {
        if ($('#room-id').val() == '') {
            $('#room-id').val(getRandomInt(10000,99999));
        }

        roomId = $('#room-id').val();
        this.disabled = true;
        connection.open(roomId);

        var link = window.location.href + '#' + roomId;
        $('#shareLink').html(link);
        $('#shareLink').attr('href', link);

        $('.share-alert').fadeIn();
    };


    $('#join-room').click(joinRoom);
</script>


<footer class="footer">
    <div class="container">
        <p class="text-muted">
            <a href="https://screen.imi.de">screen.imi.de</a> by <a href="http://www.imi.de/">iMi digital GmbH</a>
        </p>
    </div>
</footer>
</body>

</html>
